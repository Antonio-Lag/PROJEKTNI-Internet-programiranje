<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" href="checkout.css"> 
    <link rel="icon" href="faviconikona.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
</head>
<body>

    <div id="app">
        <h1>Checkout</h1>

        <div class="w3-container">
            <h2>Selected Movies/Series</h2>
            <table id="movieTable">
                <tr>
                    <th>Title</th>
                    <th>Type</th>
                    <th>Price</th>
                    <th>Action</th>
                </tr>
                <tr v-for="item in items" :key="item.id">
                    <td>{{ item.title }}</td>
                    <td>{{ item.id_series ? 'Series' : 'Movie' }}</td>
                    <td>{{ item.price }}</td>
                    <td><button @click="deleteItem(item.id_series || item.id_movies)">Remove from checkout</button></td>
                </tr>
            </table>
            <br>
            <br>
            <h2>Payment Options</h2>
            <table>
                <tr>
                    <th>Payment Method</th>
                    <th>Details</th>
                </tr>
                <tr>
                    <td>
                        <input type="radio" id="card" name="payment" value="card" v-model="paymentMethod" checked>
                        <label for="card">Card Number</label>
                    </td>
                    <td><input type="text" placeholder="Enter your card number" v-model="cardNumber"></td>
                </tr>
                <tr>
                    <td>
                        <input type="radio" id="paypal" name="payment" value="paypal" v-model="paymentMethod">
                        <label for="paypal">PayPal</label>
                    </td>
                    <td><input type="text" placeholder="Enter your PayPal email" v-if="paymentMethod === 'paypal'" v-model="paypalEmail"></td>
                </tr>
            </table>

            <button type="button" @click="submitPayment">Rent</button>
            <button type="button" @click="goBack">Back to Home</button>
        </div>

        <footer>
            <p>&copy; 2024/2025 Virtual Movie Shop</p>
        </footer>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                items: [], 
                paymentMethod: 'card',
                cardNumber: '',
                paypalEmail: ''
            },
            created() {
                this.fetchItems();
            },
            methods: {
                fetchItems() {
                    fetch('http://localhost:3001/api/checkout') 
                        .then(response => response.json())
                        .then(data => {
                            this.items = data; 
                        })
                        .catch(error => console.error('Error fetching items:', error));
                },
                deleteItem(id) {
                    const body = { id_movies: id };

                    fetch('http://localhost:3001/api/delete_checkout', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    })
                    .then(() => {
                        this.fetchItems(); 
                    })
                    .catch(error => console.error('Error deleting item:', error));
                },
                submitPayment() {
                    if (this.paymentMethod === 'card') {
                        alert('Your order has been charged to: ' + this.cardNumber);
                    } else {
                        alert('Your order has been charged to: ' + this.paypalEmail);
                    }
                    alert('You may proceed with browsing other movies/series');
                },
                goBack() {
                    window.location.href = 'Home.html'; 
                }
            }
        });
    </script>
</body>
</html>