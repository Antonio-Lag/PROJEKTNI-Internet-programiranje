<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player</title>
    <link rel="stylesheet" href="player.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <link rel="icon" href="faviconikona.ico" type="image/x-icon">



</head>
<body>
    <br>
    <div id="app">
        <h1>{{ cinematography.title}}</h1>

    
        <iframe id="videoPlayer" :src="videoUrl" frameborder="0" allowfullscreen></iframe>
        
        
        <div class="content">
            <table>
                <tr>
                    <th>Producer</th>
                    <td>{{ cinematography.producer}}</td>
                </tr>
                <tr>
                    <th>Year of Production</th>
                    <td>{{ cinematography.year_mov }}</td>
                </tr>
                <tr>
                    <th>Genre</th>
                    <td>{{ cinematography.category }}</td>
                </tr>
            </table>
        </div>
        

      
        <div class="description">
            <h2>Movie Description</h2>
            <br>
            <p>{{ cinematography.description }}</p>
        </div>
        <br>
        <br>
        <br>
        <br>
        <button id="addToCheckoutButton" @click="addToCheckout">Add to Checkout</button>
        <br>
        <div id="message" style="margin-top: 10px;">{{ checkoutMessage }}</div>
        <br>
        <br>
        <nav>
            <button onclick="location.href='http://localhost:3001/Checkout.html'">
              <i class="fas fa-shopping-cart icon"></i> <!-- Shopping kolica na botunu -->
                 Checkout
         </button>
        </nav>
        <br>
        <br>
        <div>
            <a href="Home.html">Back to Home</a>
            <br>
            <br>
            <br>
            <br>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                cinematography:{},
                checkoutMessage: ''

            },
            computed: {
                 videoUrl() {
                    return this.cinematography.video_id ? `https://www.youtube.com/embed/${this.cinematography.video_id}` : '';
                }
                    
            },
            mounted() {
                const videoId = this.getQueryParam('id');
                this.fetchCinematographyDetails(videoId);
            },
            methods: {
                getQueryParam(param) {
                    const urlParams = new URLSearchParams(window.location.search);
                    return urlParams.get(param);
                },
                fetchCinematographyDetails(id){
                    if (id>100){
                        this.fetchSeriesDetails(id);
                    } else {
                        this.fetchMovieDetails(id);

                    }

                },

                fetchMovieDetails(id) {
                fetch(`http://localhost:3001/api/movie/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        // console.log('Fetched movie data:', data); // log unos filma provjera
                        if (data.length > 0) { 
                            const movieData = data[0];
                            this.cinematography  = {
                                movie: movieData.movie,
                                producer: movieData.producer,
                                year_mov: movieData.year_mov,
                                category: movieData.category,
                                description: movieData.description_mov || 'No Description Available', 
                                video_id: movieData.video_id,
                                id:movieData.ID

                            };
                            this.selectedId = movieData.ID;
                      //  console.log('Movie data set:', this.movie); //log filma nakon unosa u bazu
                    } else {
                        console.error('No movie found for the given ID');
                    }
                 })
                    .catch(error => console.error('Error fetching movie details:', error));
                },
                fetchSeriesDetails(id){
                    fetch(`http://localhost:3001/api/series/${id}`)
                    .then(response=> response.json())
                    .then(data=>{
                       //  console.log('Fetched sereis data:', data); // Log unos serije provjera
                        if(data.length>0){
                            const seriesData= data[0];
                            this.cinematography ={
                                series: seriesData.serie,
                                producer: seriesData.producer,
                                year_mov: seriesData.year_mov,
                                category: seriesData.category,
                                description: seriesData.description || 'No Description Available', 
                                video_id: seriesData.video_id,
                                id:sereisData.id

                            };
                            // console.log('series data set:', this.series);
                            this.selectedId = seriesData.id;
                        } else {
                            console.errror('No series found for the given ID');
                        }
                    })

                    .catch(error => console.error('Error Fetching series details', error));

                },
                addToCheckout() {
                    const isSeries = !!this.cinematography.series; 
                    const itemId = this.selectedId;

                    fetch(`/api/insert_checkout`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: itemId, isSeries  }) 
            })
            .then(response => {
                if (response.ok) {
                    this.checkoutMessage = "Item successfully added to checkout, you may proceed back to HomePage";
                } else {
                    this.checkoutMessage = "Failed to add item to checkout. Please try again.";
                }
            })
            .catch(error => {
                console.error('Error adding item to checkout:', error);
                this.checkoutMessage = "An error occurred. Please try again.";
            });
                }
            }
        });
    </script>
</body>
</html>