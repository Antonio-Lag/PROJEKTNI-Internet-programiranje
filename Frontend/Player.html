<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player</title>
    <link rel="stylesheet" href="player.css"> <!-- Link to the external CSS file -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
</head>
<body>
    <br>
    <div id="app">
        <h1>{{ movie.movie }}</h1>

        <!-- YouTube video embedded using iframe -->
        <iframe id="videoPlayer" :src="videoUrl" frameborder="0" allowfullscreen></iframe>
        
        <!-- Movie details table -->
        
            <table>
                <tr>
                    <th>Producer</th>
                    <td>{{ movie.producer }}</td>
                </tr>
                <tr>
                    <th>Year of Production</th>
                    <td>{{ movie.year_mov }}</td>
                </tr>
                <tr>
                    <th>Genre</th>
                    <td>{{ movie.category }}</td>
                </tr>
            </table>
        

        <!-- Movie description -->
        <div class="description">
            <h2>Movie Description</h2>
            <p>{{ movie.description }}</p>
        </div>

        <br>
        
        <!-- Button to add item to checkout -->
        <button id="addToCheckoutButton" @click="addToCheckout">Add to Checkout</button>
        
        <!-- Message display area -->
        <div id="message" style="margin-top: 10px;">{{ checkoutMessage }}</div>

        <br>
        <div>
            <a href="Home.html">Back to Home</a>
            <br>
            <br>
            <br>
            <br>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                movie: {},
                videoUrl: 'https://www.youtube.com/embed/hJ2j4oWdQtU',
                checkoutMessage: ''

            },
            computed: {
                 videoUrl() {
                    return this.movie.video_id ? `https://www.youtube.com/embed/${this.movie.video_id}` : '';
                }
                    
            },
            mounted() {
                const movieId = this.getQueryParam('id');
                this.fetchMovieDetails(movieId);
            },
            methods: {
                getQueryParam(param) {
                    const urlParams = new URLSearchParams(window.location.search);
                    return urlParams.get(param);
                },
                fetchMovieDetails(id) {
                fetch(`http://localhost:3001/api/movie/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Fetched movie data:', data); // Log the entire response
                        if (data.length > 0) { // Check if the array has at least one element
                            const movieData = data[0]; // Access the first movie object
                            this.movie = {
                                movie: movieData.movie,
                                producer: movieData.producer,
                                year_mov: movieData.year_mov,
                                category: movieData.category,
                                description: movieData.description || 'No Description Available', // Handle undefined description
                                video_id: movieData.video_id
                            };
                        console.log('Movie data set:', this.movie); // Log the movie data after setting
                    } else {
                        console.error('No movie found for the given ID');
                    }
                 })
                    .ca2tch(error => console.error('Error fetching movie details:', error));
                }
                ,
                addToCheckout() {
                    this.checkoutMessage = "Item successfully added to checkout, you may proceed back to HomePage";
                }
            }
        });
    </script>
</body>
</html>