<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="admin.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
</head>
<body>

<div id="app">
    <h1>Admin Dashboard</h1>

    <h2>Users</h2>
    <table>
        <thead>
            <tr>
                <th>User ID</th>
                <th>Username</th>
                <th>Name</th>
                <th>Last Name</th>
                <th>Password</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="user in users" :key="user.id">
                <td>{{ user.id }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.lastName }}</td>
                <td>{{ user.password }}</td>
                <td><button @click="deleteUser (user.id)">Delete</button></td>
            </tr>
        </tbody>
    </table>

    <h2>Movies</h2>
    <form @submit.prevent="addMovie">
        <input type="text" v-model="newMovie.name" placeholder="Movie Name" required>
        <input type="text" v-model="newMovie.videoId" placeholder="Video ID" required>
        <input type="text" v-model="newMovie.image" placeholder="Image URL" required>
        <input type="text" v-model="newMovie.category" placeholder="Category" required>
        <input type="text" v-model="newMovie.year" placeholder="Year of Production" required>
        <input type="text" v-model="newMovie.producer" placeholder="Producer" required>
        <input type="text" v-model="newMovie.description" placeholder="Description" required>
        <button type="submit">Add Movie</button>
    </form>

    <div class="table-container"> 
        
        <table>
    
            <thead>
    
                <tr>
    
                    <th>Movie ID</th>
    
                    <th>Movie Name</th>
    
                    <th>Video ID</th>
    
                    <th>Image</th>
    
                    <th>Category</th>
    
                    <th>Year of Production</th>
    
                    <th>Producer</th>
    
                    <th>Description</th>
    
                </tr>
    
            </thead>
    
            <tbody>
    
                <tr v-for="(movie, index) in movies" :key="index">
    
                    <td>{{ index + 1 }}</td>
    
                    <td>{{ movie.movie }}</td>
    
                    <td>{{ movie.video_id }}</td>
    
                    <td><img :src="movie.image" alt="Movie Image" width="50"></td>
    
                    <td>{{ movie.category }}</td>
    
                    <td>{{ movie.year }}</td>
    
                    <td>{{ movie.producer }}</td>
    
                    <td>{{ movie.description }}</td>
    
                </tr>
    
            </tbody>
    
        </table>
    
    </div>

    <h2>Series</h2>
    <form @submit.prevent="addSeries">
        <input type="text" v-model="newSeries.name" placeholder="Series Name" required>
        <input type="text" v-model="newSeries.videoId" placeholder="Video ID" required>
        <input type="text" v-model="newSeries.image" placeholder="Image URL" required>
        <input type="text" v-model="newSeries.category" placeholder="Category" required>
        <input type="text" v-model="newSeries.year" placeholder="Year of Production" required>
        <input type="text" v-model="newSeries.producer" placeholder="Producer" required>
        <input type="text" v-model="newSeries.description" placeholder="Description" required>
        <button type="submit">Add Series</button>
    </form>

    <div class="table-container"> 
        
        <table>
    
            <thead>
    
                <tr>
    
                    <th>Series ID</th>
    
                    <th>Series Name</th>
    
                    <th>Video ID</th>
    
                    <th>Image</th>
    
                    <th>Category</th>
    
                    <th>Year of Production</th>
    
                    <th>Producer</th>
    
                    <th>Description</th>
    
                </tr>
    
            </thead>
    
            <tbody>
    
                <tr v-for="(serie, index) in series" :key="index">
    
                    <td>{{ index + 101 }}</td>
    
                    <td>{{ serie.serie }}</td>
    
                    <td>{{ serie.video_id }}</td>
    
                    <td><img :src="serie.image" alt="Series Image" width="50"></td>
    
                    <td>{{ serie.category }}</td>
    
                    <td>{{ serie.year }}</td>
    
                    <td>{{ serie.producer }}</td>
    
                    <td>{{ serie.description }}</td>
    
                </tr>
    
            </tbody>
    
        </table>
    
    </div>



<script>
new Vue({
    el: '#app',
    data: {
        users: [],
        movies: [],
        series: [],
        rentals: [],
        movieData:[],
        seriesData:[],
        newMovie: {
            name: '',
            videoId: '',
            image: '',
            category: '',
            year: '',
            producer: '',
            description: ''
        },
        newSeries:{
            name:'',
            videoId: '',
            image: '',
            category: '',
            year: '',
            producer: '',
            description: ''
        }
    },
    mounted() {
        this.fetchMovies();
        this.fetchSeries();
        this.fetchUsers();
        this.fetchRentals();
    },
    methods: {
        fetchMovies() {
            fetch('/api/movie')
                .then(response => response.json())
                .then(data => {
                    this.movies = data.map(movie => ({
                        movie: movie.movie,
                        video_id: movie.video_id,
                        image: movie.image,
                        category: movie.category,
                        year: movie.year_mov,
                        producer: movie.producer,
                        description: movie.description_mov
                    }));
                })
                .catch(error => console.error('Error fetching movies:', error));
        },
        fetchUsers() {
            fetch('/api/users')
            .then(response => response.json())
            .then(data => {
                this.users = data.map(user => ({
                        id: user.user_id,
                        username: user.username,
                        name: user.name_sr,
                        lastName: user.last_name,
                        password: user.password
                        }));
                })
                .catch(error => console.error('Error fetching users:', error));
        },


        fetchSeries() { //logika za unos serija
            fetch('/api/series')
                .then(response => response.json())
                .then(data => {
                    this.series = data.map(serie => ({
                        serie: serie.serie,
                        video_id: serie.video_id,
                        image: serie.image,
                        category: serie.category,
                        year: serie.year_mov,
                        producer: serie.producer,
                        description: serie.description
                    }));
                })
                .catch(error => console.error('Error fetching series:', error));
        },

            

        addSeries() 
        {
            const seriesData = {
                serie: this.newSeries.name,
                video_id: this.newSeries.videoId,
                image: this.newSeries.image,
                category: this.newSeries.category,
                year_mov: this.newSeries.year,
                producer: this.newSeries.producer,
                description: this.newSeries.description
            };
            
            fetch('http://localhost:3001/api/insert_series', {
             method: 'POST',

            headers: {

                'Content-Type': 'application/json'

            },

            body: JSON.stringify(seriesData)

        })

        .then(response => {

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            return response.json();

        })

        .then(data => {
            this.newSeries = {

                name: '',
                videoId: '',
                image: '',
                category: '',
                year: '',
                producer: '',
                description: ''

            };

        })

        .catch(error => console.error('Error adding series:', error));

        },


        addMovie() 
        {
            const movieData = {
                movie: this.newMovie.name,
                video_id: this.newMovie.videoId,
                image: this.newMovie.image,
                category: this.newMovie.category,
                year_mov: this.newMovie.year,
                producer: this.newMovie.producer,
                description_mov: this.newMovie.description
            };
            
            fetch('http://localhost:3001/api/insert_movie', {
             method: 'POST',

            headers: {

                'Content-Type': 'application/json'

            },

            body: JSON.stringify(movieData)

        })

        .then(response => {

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            return response.json();

        })

        .then(data => {
            this.newSeries = {

                name: '',
                videoId: '',
                image: '',
                category: '',
                year: '',
                producer: '',
                description: ''

            };

        })

        .catch(error => console.error('Error adding movie:', error));

        },

        


        deleteUser (userId) {
            
            fetch(`http://localhost:3001/api/delete_user/${userId}`, {

                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                this.users = this.users.filter(user => user.id !== userId);
            })
            .catch(error => console.error('Error deleting user:', error));


        }
    }
});
</script>

</body>
</html>