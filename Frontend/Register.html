<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration</title>
    <link rel="stylesheet" href="style_log_reg.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
</head>
<body>
    <nav>
        <a href="Login.html">Login</a>
        <a href="Home.html">Home page</a>
    </nav>
    <div class="w3-container w3-cyan">
        <h1>Virtual Movie Shop</h1> 
    </div>

    <div class="w3-container centered">
        Register your account
    </div>

    <div id="app" class="w3-container">
        

        <label class="w3-text-blue">Name:</label>
        <input type="text" v-model="name" class="w3-input w3-border">

        <label class="w3-text-blue">Last Name:</label>
        <input type="text" v-model="surname" class="w3-input w3-border">

        <label class="w3-text-blue">User  Name:</label>
        <input type="text" v-model="username" class="w3-input w3-border">

        <label class="w3-text-blue">Password:</label>
        <input type="password" v-model="password" class="w3-input w3-border">

        <label class="w3-text-blue">Confirm Password:</label>
        <input type="password" v-model="passwordcheck" class="w3-input w3-border">
        <br>
        <br>
        <button class="w3-btn w3-blue" @click="register">Register</button>
        <div id="data">{{ message }}</div>
    </div>

    <div class="w3-container w3-cyan">
        <footer>Telematika 2024/25 | <span id="current-date"></span></footer>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                name: '',
                surname: '',
                username: '',
                password: '',
                passwordcheck: '',
                message: ''
            },
            methods: {
                register() {
                    if (this.name === '' || this.surname === '' || this.username === '' || this.password === '' || this.passwordcheck === '') {
                        this.message = "Please check your registration information!";
                        return;
                    }

                    if (this.password !== this.passwordcheck) {
                        this.message = "Passwords do not match!";
                        return;
                    }

                    const userData = {
                        name: this.name,
                        surname: this.surname,
                        username: this.username,
                        password: this.password
                    };

                    fetch('http://localhost:3001/api/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(userData)
                    })
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(err => { throw new Error(err.message); });
                        }
                        return response.json();
                    })
                    .then(data => {
                        this.message = "Registration successful!";
                        this.resetForm();
                    })
                    .catch(error => {
                        this.message = error.message || "Registration failed!";
                    });
                },
                resetForm() {
                    this.name = '';
                    this.surname = '';
                    this.username = '';
                    this.password = '';
                    this.passwordcheck = '';
                }
            }
        });

        function Date_print(){
            const date = new Date();
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const formattedDate = date.toLocaleDateString('en-GB', options);
            document.getElementById("current-date").innerHTML = formattedDate; 
        }
        
        window.onload = function() {
            Date_print(); 
        };
    </script>
</body>
</html>